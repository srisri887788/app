<!doctype html>
<html lang="en">

<head>

    <link rel="canonical" href="https://getbootstrap.com/docs/3.4/">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>

<body class="bs-docs-home">
    <!-- container -->
    <div class="container">
        <div id="employee-details">
            <!-- Render HTML Tabular data -->
        </div>
        <!-- Form manipulations -->
        <div class ="row">
            <div class="col-md-6">
                <form onsubmit="Employee.addEmployee()">
                    <div class="form-group">
                        <label for="EmployeeName">Add an Employee</label>
                        <input type="text" class="form-control" id="employeeName" placeholder="Employee Name" required/>
                        <input type="number" class="form-control mt-3" id="employeeSalary" placeholder="Employee salary" required/>
                        <p class="font-italic mt-3">Promoted?</p>
                        <select class="custom-select custom-select-m mb-3" id="employeeStatus" required >  
                            <option value="1">Yes</option>
                            <option value="2">No</option>            
                          </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" >Submit</button>
                    <button type="button" class="btn btn-danger" onclick="Employee.deleteEmployees()">Delete Promoted Folks</button>
                </form>
            </div>
        </div>
    </div>


    <script>
        var Employee = (function () {
            let state = {
                employees:[],
                totalEmployees:0,
                promotedEmployees:0,
                totalSalary:0
            };   
            

            const render = () => {
                
                document.getElementById('employee-details').innerHTML = '';
                employeesDetailsCalculation();
                const tbodyContentHTML = () => {
                   const {employees }= state
                  return  employees.map(({name, isPromoted = false,salary },index) => {
                        return `
                        <tbody>
                            <tr id=${index}>
                                <th>${name}</th>
                                <td><input type="checkbox" ${isPromoted === true ? 'checked' : ''} onclick="Employee.changeEmployeeStatus(${index})"/></td>
                                <td>${salary}</td>
                                <td><button type="button" class="btn btn-primary btn-sm" onclick="Employee.deletIndividualEmployee(${index})">Delete</button></td>
                            </tr>
                        </tbody>
                    `

                    }).join('');
                }

                const template =  `
                <div class="alert alert-info">${state.totalEmployees >0 ?`${state.promotedEmployees} are promoted out of ${state.totalEmployees}` : `No Employee Present`} </div>
                
                <table class="table">
                   
                    <div> <caption>Total Salary Credited ${state.totalSalary}<span class="font-weight-bold"> &#8377;</span></caption></div>
                    <caption>Employee Promotion details.</caption>
                    <thead>
                        <tr>
                            <th>Employee Name</th>
                            <th>Promoted (y/n)</th>
                            <th>Salary</th>
                            <th>Delete Employee</th>
                        </tr>
                    </thead>
                    
                    ${
                        tbodyContentHTML()
                    }
                </table>
               
                `
                document.getElementById('employee-details').innerHTML = template;

            }



            const employeesDetailsCalculation =()=>{
                state.totalEmployees = state.employees.length
                state.totalSalary = state.employees.reduce((total,item)=>{
                    return (total)+parseInt(item.salary)
                },0)
                state.promotedEmployees = [...state.employees.filter(item=>item.isPromoted)].length
            
            }
            

            const deletIndividualEmployee = (deleteIndex)=>{
                state.employees = state.employees.filter((value,index)=>index!==deleteIndex)
                render()
            }
            


            const changeEmployeeStatus = employeeIndex =>{             
                state.employees = state.employees.map((value,index)=>{
                    if(index===employeeIndex){
                        value.isPromoted=!value.isPromoted
                    }
                    return value
                })
                render()               
            }

            const addEmployee = ()=> {
                event.preventDefault();
                state.employees = [...state.employees, {
                   name: document.getElementById('employeeName').value,
                   salary:document.getElementById('employeeSalary').value,
                   isPromoted: document.getElementById('employeeStatus').value === "1"?true:false
                }]
               render();
               document.getElementById('employeeName').value = ''
               document.getElementById('employeeSalary').value = ''
               document.getElementById('employeeStatus').value='1'
            }

            const deleteEmployees = () => {
                state.employees = state.employees.filter(item => !item.isPromoted);
                render();
            }

            const fetchEmployees= ()=>{
              fetch(' https://jsonblob.com/api/jsonBlob/51e424ef-59da-11ea-bd1e-5357e8a85ff2')
                .then(response => response.json())
                .then(json=>{
                     state.employees = [...json]
                     render();                    
                })              
               }

            return {
                render,
                addEmployee,
                deleteEmployees,
                deletIndividualEmployee,
                changeEmployeeStatus,
                fetchEmployees
            }

        })()
    Employee.fetchEmployees();

    </script>

</body>

</html>